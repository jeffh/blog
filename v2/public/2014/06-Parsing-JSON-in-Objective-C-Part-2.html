<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Parsing JSON in Objective-C - Part 2 | jeffhui.net</title>
<meta name="keywords" content="Objective-C, Testing, Series: Parsing JSON in Objective-C">
<meta name="description" content="Note: This previously was on
Pivotal Labs blog.
In the previous article, we used TDD to
parse JSON into our Person model and refactored the code under test. In part
2, we&rsquo;re going to refactor the code further to be more reusable and extendable.
All the code in this article will also be in the
same repository.
Redesign
The refactorings in the previous article were fairly straightforward and
mechanical. Ultimately, we’ll need to break apart different concerns of this
code. One approach would be to start with some questions:">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/2014/06-Parsing-JSON-in-Objective-C-Part-2.html">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/2014/06-Parsing-JSON-in-Objective-C-Part-2.html">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="jeffhui.net (Alt + H)">jeffhui.net</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/writings/" title="Writings">
                    <span>Writings</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Parsing JSON in Objective-C - Part 2
    </h1>
    <div class="post-meta"><span title='2014-11-08 00:00:00 +0000 UTC'>November 8, 2014</span>&nbsp;·&nbsp;9 min

</div>
  </header> 
  <div class="post-content"><p><em>Note: This previously was on
<a href="http://pivotallabs.com/parsing-json-objective-c-part-2/">Pivotal Labs blog</a>.</em></p>
<p>In the <a href="05-parsing-json-in-objective-c-part-1">previous article</a>, we used TDD to
parse JSON into our <code>Person</code> model and refactored the code under test. In part
2, we&rsquo;re going to refactor the code further to be more reusable and extendable.
All the code in this article will also be in the
<a href="https://github.com/jeffh/ParsingJSON/">same repository</a>.</p>
<h1 id="redesign">Redesign<a hidden class="anchor" aria-hidden="true" href="#redesign">#</a></h1>
<p>The refactorings in the previous article were fairly straightforward and
mechanical. Ultimately, we’ll need to break apart different concerns of this
code. One approach would be to start with some questions:</p>
<ul>
<li>What is the problem we&rsquo;re trying to solve?</li>
<li>How can the problem be broken into smaller problems to solve in separate
pieces?</li>
<li>What is domain-knowledge code? What is generic, machinery code? How can we
separate them?</li>
<li>What are the tradeoffs of the solution?</li>
</ul>
<p>There are many possible solutions, but I&rsquo;ll present just one which tries to
maximize flexibility and minimize the machinery.</p>
<p>When designing an API, it’s common to confuse easy with simple. I recommend
watching Rich Hickey’s
<a href="http://www.infoq.com/presentations/Simple-Made-Easy">Simple Made Easy Talk</a>. In
summary, simplicity is about keeping things unentangled.</p>
<p>Here&rsquo;s how the solution tries to answer the questions:</p>
<h2 id="what-is-the-problem-were-trying-to-solve">What is the problem we&rsquo;re trying to solve?<a hidden class="anchor" aria-hidden="true" href="#what-is-the-problem-were-trying-to-solve">#</a></h2>
<p><a href="http://en.wikipedia.org/wiki/Data_mapping">Data Mapping</a>. Converting one tree
of value objects into another tree of value objects. This code should treat the
input of values as untrusted data and avoid any exceptions. This is functional -
it&rsquo;s not covering anything related to network code.</p>
<h2 id="how-can-the-problem-be-broken-into-smaller-problems-to-solve-in-separate-pieces">How can the problem be broken into smaller problems to solve in separate pieces?<a hidden class="anchor" aria-hidden="true" href="#how-can-the-problem-be-broken-into-smaller-problems-to-solve-in-separate-pieces">#</a></h2>
<p>Data mapping is a fractal problem. For example, converting string to integer is
a subset of converting an array of strings to an array of integers.</p>
<h2 id="what-is-domain-knowledge-code-what-is-generic-machinery-code-how-can-we-separate-them">What is domain-knowledge code? What is generic, machinery code? How can we separate them?<a hidden class="anchor" aria-hidden="true" href="#what-is-domain-knowledge-code-what-is-generic-machinery-code-how-can-we-separate-them">#</a></h2>
<p>The domain knowledge are the specific values that are input and output. Names of
things: fields, objects, and properties are all domain specific. The operations
that transform the input into the output are generic, machinery code. They can
be transposed to different problem domains (for instance, JSON vs. XML).</p>
<h2 id="what-are-the-tradeoffs-of-the-solution">What are the tradeoffs of the solution?<a hidden class="anchor" aria-hidden="true" href="#what-are-the-tradeoffs-of-the-solution">#</a></h2>
<p>Composition increases the number of lines of code. If publicly exposed, this
greatly increases the surface area of the API to test and for end-users to
learn.</p>
<h1 id="building-the-abstraction">Building the Abstraction<a hidden class="anchor" aria-hidden="true" href="#building-the-abstraction">#</a></h1>
<p>So we want a simpler abstraction. Making the code more uniform is what an
abstraction is for. So let’s go with something similar to the original method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">Mapper</span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">objectFromJSONObject:</span>(<span style="color:#66d9ef">id</span>)jsonObject <span style="color:#a6e22e">error:</span>(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>Refraining from adding more methods is generally a good thing. Otherwise the
interface becomes like the
<a href="http://docs.oracle.com/javase/7/docs/api/java/util/Set.html">Java Set interface</a>
with 15 methods. Each method added to an interface leaks the abstraction -
dictating implementation details. It’s better to use composition to make an
abstraction easier to use instead of mixing the ease and abstraction together.
For example, the one <code>Mapper</code> method implicitly dictates a synchronous API.</p>
<p>We’ll keep the public interface the same until the end for now.</p>
<p>So lets move the code previously in methods into separate classes. We’ll &ldquo;talk&rdquo;
to other methods through the <code>Mapper</code> protocol. For example,
<code>-[peopleFromJSONObject:error:]</code> is extracted into two parts:</p>
<ul>
<li>A mapper that uses another mapper on every element of an array. (Pure
machinery)</li>
<li>A mapper to convert JSON into a Person object. (More domain)</li>
</ul>
<p>Here’s the mapper for every element in an array:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ArrayMapper</span> <span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>) <span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> mapper;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (instance)<span style="color:#a6e22e">initWithItemMapper:</span>(<span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span>)mapper;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ArrayMapper</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// … init method here …
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">objectFromSourceObject:</span>(<span style="color:#66d9ef">id</span>)jsonObject <span style="color:#a6e22e">error:</span>(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error {
</span></span><span style="display:flex;"><span>    NSMutableArray <span style="color:#f92672">*</span>transformedItems <span style="color:#f92672">=</span> [NSMutableArray array];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">id</span> item <span style="color:#66d9ef">in</span> jsonObject) {
</span></span><span style="display:flex;"><span>        NSError <span style="color:#f92672">*</span>itemError <span style="color:#f92672">=</span> nil;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">id</span> transformedItem <span style="color:#f92672">=</span> [self.itemMapper objectFromSourceObject:item error:<span style="color:#f92672">&amp;</span>itemError];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (itemError) {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">*</span>error <span style="color:#f92672">=</span> itemError;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> nil;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            [transformedItems addObject:transformedItem];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> transformedItems;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>We can further break apart the theoretical Person Mapper class. There is the
domain of the keys and models to map, but the actual process is purely machinery
work. We’ll generically map keys of one object to keys of another object using
<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/KeyValueCoding/Articles/KeyValueCoding.html">KVC</a>
to remove a custom class.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ObjectMapper</span> : <span style="color:#a6e22e">NSObject</span> <span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>) <span style="color:#66d9ef">Class</span> classOfObjectToCreate;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">copy</span>) NSDictionary <span style="color:#f92672">*</span>jsonKeysToFields;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">copy</span>) NSDictionary <span style="color:#f92672">*</span>fieldsToMappers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithGeneratorOfClass:</span>(<span style="color:#66d9ef">Class</span>)classOfObjectToCreate
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">jsonKeysToFields:</span>(NSDictionary <span style="color:#f92672">*</span>)jsonKeysToFields
</span></span><span style="display:flex;"><span>                         <span style="color:#a6e22e">fieldsToMappers:</span>(NSDictionary <span style="color:#f92672">*</span>)fieldsToMappers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ObjectMapper</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// … init method here …
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">objectFromJSONObject:</span>(<span style="color:#66d9ef">id</span>)jsonObject <span style="color:#a6e22e">error:</span>(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>error <span style="color:#f92672">=</span> nil;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">id</span> object <span style="color:#f92672">=</span> [[self.classOfObjectToCreate alloc] init];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">id</span> jsonKey <span style="color:#66d9ef">in</span> self.jsonKeysToFields) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">id</span> field <span style="color:#f92672">=</span> self.jsonKeysToFields[jsonKey];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// note: this is an assumption here. We may not want to always use key path.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">id</span> value <span style="color:#f92672">=</span> [jsonObject valueForKeyPath:jsonKey];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> valueMapper <span style="color:#f92672">=</span> self.fieldsToMappers[field];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (valueMapper) {
</span></span><span style="display:flex;"><span>            value <span style="color:#f92672">=</span> [valueMapper objectFromJSONObject:value error:error];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>error) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> nil;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (value) { <span style="color:#75715e">// setValue:forKey: fails if value is nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            [object setValue:value forKey:field];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> object;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>You can see the other refactors in the
<a href="https://github.com/jeffh/ParsingJSON/tree/05-convert-most-methods-into-using-mappers">tagged repository</a>.
But the basic goal is move all methods into separate classes that conform to our
new <code>Mapper</code> protocol. But the methods tend to bind details of the machinery of
data mapping and the domain of what objects we’re specifically operating on.</p>
<p>Now our high-level solution becomes an object composition problem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span>- (Person <span style="color:#f92672">*</span>)<span style="color:#a6e22e">personFromJSONObject:</span>(<span style="color:#66d9ef">id</span>)json <span style="color:#a6e22e">error:</span>(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> stringToNumberMapper <span style="color:#f92672">=</span> [[StringToNumberMapper alloc] init];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> friendMapper <span style="color:#f92672">=</span> [[ObjectMapper alloc] initWithGeneratorOfClass:[Person <span style="color:#66d9ef">class</span>]
</span></span><span style="display:flex;"><span>                                                            jsonKeysToFields:<span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;id&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;identifier&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                               <span style="color:#e6db74">@&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>                                                                               <span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#ae81ff">}</span>
</span></span><span style="display:flex;"><span>                                                             fieldsToMappers:<span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#f92672">:</span> stringToNumberMapper<span style="color:#ae81ff">}</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> friendsMapper <span style="color:#f92672">=</span> [[ArrayMapper alloc] initWithItemMapper:friendMapper];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    NSDictionary <span style="color:#f92672">*</span>jsonKeysToFields <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;id&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;identifier&#34;</span>,
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">@&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;height&#34;</span>,
</span></span><span style="display:flex;"><span>                                       <span style="color:#e6db74">@&#34;friends&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;friends&#34;</span><span style="color:#ae81ff">}</span>;
</span></span><span style="display:flex;"><span>    NSDictionary <span style="color:#f92672">*</span>fieldsToMappers <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#f92672">:</span> stringToNumberMapper,
</span></span><span style="display:flex;"><span>                                      <span style="color:#e6db74">@&#34;friends&#34;</span><span style="color:#f92672">:</span> friendsMapper<span style="color:#ae81ff">}</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> objectMapper <span style="color:#f92672">=</span> [[ObjectMapper alloc] initWithGeneratorOfClass:[Person <span style="color:#66d9ef">class</span>]
</span></span><span style="display:flex;"><span>                                                            jsonKeysToFields:jsonKeysToFields
</span></span><span style="display:flex;"><span>                                                             fieldsToMappers:fieldsToMappers];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [objectMapper objectFromJSONObject:json error:error];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is more code! But functional programmers might recognize this as a
restricted, verbose version of
<a href="http://en.wikipedia.org/wiki/Partial_function">partial functions</a>. They
maximize the amount of flexibility and code reuse - especially if they’re
<a href="http://en.wikipedia.org/wiki/Pure_function">pure functions</a>.
<a href="http://en.wikipedia.org/wiki/Data_mapping">Data mapping</a> happens to fit a
purely functional operation: converting one value object to another.
Unfortunately, Objective-C doesn’t treat functions as first class citizens in
the language (and therefore, it isn&rsquo;t idiomatic to compose functions).
Object-oriented programming can still represent partial functions, but with more
boilerplate. In exchange for a bit more code our objects become more
<a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">SOLID</a>, honoring
the concepts of
<a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility</a>
and
<a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency Inversion</a>.</p>
<h2 id="taking-it-to-the-extreme">Taking it to the Extreme<a hidden class="anchor" aria-hidden="true" href="#taking-it-to-the-extreme">#</a></h2>
<p>To indicate that this protocol works for more than just JSON objects, we can
rename the method on <code>Mapper</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">Mapper</span> <span style="color:#f92672">&lt;</span>NSObject<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> (<span style="color:#66d9ef">id</span>)objectFromSourceObject:(<span style="color:#66d9ef">id</span>)sourceObject error:(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>But it’s pretty much the same otherwise. Using <code>Mapper</code>, we can expand to cover
all behavioral aspects of data mapping and try to clean up the remaining private
methods we extracted earlier. Abstracting common operations to be more
declarative can make the associated code more useful for the general data
mapping problem we’re solving. Let’s look at a new <code>ChainMapper</code> class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ChainMapper</span> : <span style="color:#a6e22e">NSObject</span> <span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">copy</span>) NSArray <span style="color:#f92672">*</span>mappers;
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithMappers:</span>(NSArray <span style="color:#f92672">*</span>)mappers;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ChainMapper</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// … init method here …
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">objectFromSourceObject:</span>(<span style="color:#66d9ef">id</span>)sourceObject <span style="color:#a6e22e">error:</span>(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>error <span style="color:#f92672">=</span> nil;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">id</span> result <span style="color:#f92672">=</span> sourceObject;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> mapper <span style="color:#66d9ef">in</span> self.mappers) {
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> [mapper objectFromSourceObject:result error:error];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>error) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> nil;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>This class simply chains each mapper’s results to the one after it, unless an
error occurs. So the only public method on <code>PersonParser</code> changes to utilize
more of this protocol:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span>- (Person <span style="color:#f92672">*</span>)<span style="color:#a6e22e">personFromJSONData:</span>(NSData <span style="color:#f92672">*</span>)jsonData <span style="color:#a6e22e">error:</span>(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error {
</span></span><span style="display:flex;"><span>    JSONDataToObjectMapper <span style="color:#f92672">*</span>jsonMapper <span style="color:#f92672">=</span> [[JSONDataToObjectMapper alloc] initWithErrorDomain:kParserErrorDomain
</span></span><span style="display:flex;"><span>                                                                                   errorCode:kParserErrorCodeBadData];
</span></span><span style="display:flex;"><span>    ErrorIfMapper <span style="color:#f92672">*</span>errorMapper <span style="color:#f92672">=</span> [[ErrorIfMapper alloc] initWithErrorDomain:kParserErrorDomain
</span></span><span style="display:flex;"><span>                                                                  errorCode:kParserErrorCodeNotFound
</span></span><span style="display:flex;"><span>                                                                   userInfo:<span style="color:#ae81ff">@{</span>NSLocalizedDescriptionKey: <span style="color:#e6db74">@&#34;No person was found&#34;</span><span style="color:#ae81ff">}</span>
</span></span><span style="display:flex;"><span>                                                       errorIfJSONKeyExists:<span style="color:#e6db74">@&#34;message&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    NSArray <span style="color:#f92672">*</span>mappersToTry <span style="color:#f92672">=</span> <span style="color:#ae81ff">@[</span>jsonMapper, errorMapper, [self personMapper]<span style="color:#ae81ff">]</span>;
</span></span><span style="display:flex;"><span>    ChainMapper <span style="color:#f92672">*</span>mapper <span style="color:#f92672">=</span> [[ChainMapper alloc] initWithMappers:mappersToTry];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [mapper objectFromSourceObject:jsonData error:error];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Which essentially describes a data flow diagram:</p>
<pre tabindex="0"><code>jsonMapper -&gt; errorMapper -&gt; personMapper -&gt; Person Object
     |            |              |
   error        error          error
</code></pre><p>Oh yeah, did I forget to mention all the tests still pass? We didn’t change the
public API, so we didn’t change any tests. You can view all the code
<a href="https://github.com/jeffh/ParsingJSON/tree/06-full-refactor-to-one-protocol">we changed up to this point</a>.</p>
<blockquote>
<p>Running With Random Seed: 23518</p>
<p>&hellip;&hellip;&hellip;.</p>
<p>Finished in 0.1246 seconds</p>
<p>10 examples, 0 failures</p>
</blockquote>
<h1 id="extending-the-design">Extending the Design<a hidden class="anchor" aria-hidden="true" href="#extending-the-design">#</a></h1>
<p>Now let’s expand the design to something it wasn’t managing before. Optional
mapping.</p>
<p>An optional mapping is a mapping that can <strong>succeed by not mapping a value</strong>. An
example usage is when mapping arrays.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Input: @[@&#34;foo&#34;, @&#34;10&#34;, @&#34;20&#34;]
</span></span><span style="display:flex;"><span>&lt;mapping magic&gt;
</span></span><span style="display:flex;"><span>Output: @[@10, @20]
</span></span></code></pre></div><p>The first element in the input is dropped from the array as invalid input (it
can’t be converted to a number). But we still want the possibility that we can
reject the entire array if we want.</p>
<p>So we need to modify the contract of our protocol. I’ll propose adding a key to
the <code>userInfo</code> of NSErrors returned:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> NSString <span style="color:#f92672">*</span>kIsNonFatalKey;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">Mapper</span> <span style="color:#f92672">&lt;</span>NSObject<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> (<span style="color:#66d9ef">id</span>)objectFromSourceObject:(<span style="color:#66d9ef">id</span>)jsonObject error:(<span style="color:#66d9ef">__autoreleasing</span> NSError <span style="color:#f92672">**</span>)error;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>If this key is set to <code>@YES</code>, then mappers can choose to suppress the error and
continue. A perfect use is for the <code>ArrayMapper</code> to simply drop that value when
producing the array. The new <code>OptionalMapper</code> simply converts an error from a
mapper its given into this non-fatal error. Composing both gives us our bigger
solution:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span>NSDictionary <span style="color:#f92672">*</span>jsonKeysToFields <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;id&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;identifier&#34;</span>,
</span></span><span style="display:flex;"><span>                                   <span style="color:#e6db74">@&#34;name&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>                                   <span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#ae81ff">}</span>;
</span></span><span style="display:flex;"><span>NSDictionary <span style="color:#f92672">*</span>fieldsToMappers <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;height&#34;</span><span style="color:#f92672">:</span> stringToNumber,
</span></span><span style="display:flex;"><span>                                  <span style="color:#e6db74">@&#34;id&#34;</span><span style="color:#f92672">:</span> required,
</span></span><span style="display:flex;"><span>                                  <span style="color:#e6db74">@&#34;name&#34;</span><span style="color:#f92672">:</span> required<span style="color:#ae81ff">}</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> friendMapper <span style="color:#f92672">=</span> [[ObjectMapper alloc] initWithGeneratorOfClass:[Person <span style="color:#66d9ef">class</span>]
</span></span><span style="display:flex;"><span>                                                        jsonKeysToFields:jsonKeysToFields
</span></span><span style="display:flex;"><span>                                                         fieldsToMappers:fieldsToMappers];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> objectToFriendOrEmpty <span style="color:#f92672">=</span> [[OptionalMapper alloc] initWithMapper:friendMapper];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>Mapper<span style="color:#f92672">&gt;</span> objectToFriends <span style="color:#f92672">=</span> [[ArrayMapper alloc] initWithItemMapper:objectToFriendOrEmpty];
</span></span></code></pre></div><p>The code changes are relatively straightforward. You can see the final code in
the <a href="https://github.com/jeffh/ParsingJSON">repository</a>.</p>
<h1 id="closing-thoughts">Closing Thoughts<a hidden class="anchor" aria-hidden="true" href="#closing-thoughts">#</a></h1>
<p>All the composition gives us significant flexibility to extend the system. An
example is a generic object-to-object mapper - we can build a mapper that:</p>
<ul>
<li>Uses reflection to figure out mapping of JSON keys to model properties</li>
<li>Automatically determine which types to parse</li>
<li>Add fallback parsing strategies (e.g. - parsing all the known RFC formats of
date strings)</li>
<li>Type-checking input</li>
<li>Allowing end-user customization when required.</li>
</ul>
<p>All of which builds on top of existing functionality. A perfect example is
<a href="https://github.com/jeffh/Hydrant">Hydrant</a>’s
<a href="https://github.com/jeffh/Hydrant/blob/b9bfad919dd61f49d5b869788690dbd312a72a68/Hydrant/Public/Mappers/Facade/HYDReflectiveMapper.m#L227-286">ReflectiveMapper class</a>
(which is verbose simply because it is an immutable builder too). Most of it’s
functionality is achieved by composing other objects in Hydrant.</p>
<h2 id="try-it-at-home">Try it at Home<a hidden class="anchor" aria-hidden="true" href="#try-it-at-home">#</a></h2>
<p>Obviously, the example code for this article isn’t thorough in covering all the
error cases and is for demonstrative purposes. There are many ways to expand
this code:</p>
<ul>
<li>Cover more edge cases
<ul>
<li>Check <code>NSError **</code> isn’t NULL before using it</li>
<li>Check for types of the source object before processing them</li>
</ul>
</li>
<li>Handle parsing other data types (XML, YAML, etc.)</li>
<li>If we’re making the individual mapper classes public, we should consider
adding tests to them.</li>
</ul>
<p>As well as areas that haven’t seen a design treatment:</p>
<ul>
<li>How can we support key paths and key values simultaneously?</li>
<li>Is using a userInfo key a good approach for this?</li>
<li>Can we generalize <code>ArrayMapper</code> to more than arrays?</li>
<li>How can we generalize <code>ObjectMapper</code> to be recursive?</li>
<li>How can we support mapping many-to-many relationships? (e.g. - day, time keys
into a date property).</li>
<li>How can we serialize something back into JSON without having to repeat
ourselves (the end-user)?</li>
<li>How can we provide enough information for end-users to debug when a mistake in
data mapping has been made?</li>
</ul>
<p>Many of these concepts are explored in the
<a href="https://github.com/jeffh/Hydrant">Hydrant</a> project, but I encourage you to
explore the problem and possible solutions on your own.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/objective-c/">Objective-C</a></li>
      <li><a href="http://localhost:1313/tags/testing/">Testing</a></li>
      <li><a href="http://localhost:1313/tags/series-parsing-json-in-objective-c/">Series: Parsing JSON in Objective-C</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/2015/07-Generative-Testing.html">
    <span class="title">« Prev</span>
    <br>
    <span>Generative Testing</span>
  </a>
  <a class="next" href="http://localhost:1313/2014/05-Parsing-JSON-in-Objective-C-Part-1.html">
    <span class="title">Next »</span>
    <br>
    <span>Parsing JSON in Objective-C - Part 1</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on x"
            href="https://x.com/intent/tweet/?text=Parsing%20JSON%20in%20Objective-C%20-%20Part%202&amp;url=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html&amp;hashtags=Objective-C%2cTesting%2cSeries%3aParsingJSONinObjective-C">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html&amp;title=Parsing%20JSON%20in%20Objective-C%20-%20Part%202&amp;summary=Parsing%20JSON%20in%20Objective-C%20-%20Part%202&amp;source=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html&title=Parsing%20JSON%20in%20Objective-C%20-%20Part%202">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on whatsapp"
            href="https://api.whatsapp.com/send?text=Parsing%20JSON%20in%20Objective-C%20-%20Part%202%20-%20http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on telegram"
            href="https://telegram.me/share/url?text=Parsing%20JSON%20in%20Objective-C%20-%20Part%202&amp;url=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Parsing JSON in Objective-C - Part 2 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Parsing%20JSON%20in%20Objective-C%20-%20Part%202&u=http%3a%2f%2flocalhost%3a1313%2f2014%2f06-Parsing-JSON-in-Objective-C-Part-2.html">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">jeffhui.net</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
